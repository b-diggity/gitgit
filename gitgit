#!/bin/bash

GITVER=$(git --version | awk '{print $3}' | awk -F'.' '{print $1"."$2}')
GITMIN="2.25"
if (( $(echo "$GITVER < $GITMIN" | bc -l) ))
then
	echo "git version is too low! Update now!"
	echo "Your version: $GITVER | Minimum version required: $GITMIN"
	echo "sudo add-apt-repository ppa:git-core/ppa"
	echo "sudo apt update"
	echo "sudo apt install git"
fi

TREEBRANCH=$(git branch --show-current)

if [[ "$TREEBRANCH" =~ ^(main|master) ]]
then
	echo "You are on the main branch, exiting..."
	exit 1
else
	echo "On Branch: $TREEBRANCH"
	git add .

	if [ -z "$1" ]
	then
		COMMITNOW="Changes to code on $(date)"
	else
		COMMITNOW="$1"
	fi

	git commit -m "$COMMITNOW"
	git push origin $TREEBRANCH
fi
